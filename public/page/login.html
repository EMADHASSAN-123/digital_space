<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ â€” Ù…Ø³Ø§Ø­Ø© Ø±Ù‚Ù…ÙŠØ©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { supabase } from '../../admin/assets/js/supabaseClient.js';

    document.addEventListener('DOMContentLoaded', () => {
      const loginForm = document.getElementById('login-form');
      const signupForm = document.getElementById('signup-form');
      const magicForm = document.getElementById('magic-form');

      const msgBox = document.getElementById('msg-box');
      const googleBtn = document.getElementById('google-btn');
      const githubBtn = document.getElementById('github-btn');

      // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
      function showMessage(message, type = 'info') {
        msgBox.innerHTML = `<div class="p-3 rounded-lg text-sm ${
          type === 'error'
            ? 'bg-red-100 text-red-700'
            : type === 'success'
            ? 'bg-green-100 text-green-700'
            : 'bg-blue-100 text-blue-700'
        }">${message}</div>`;
      }

      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = e.target.email.value.trim();
        const password = e.target.password.value.trim();

        showMessage('Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...', 'info');

        const { data, error } = await supabase.auth.signInWithPassword({
          email,
          password,
        });

        if (error) {
          showMessage('Ø®Ø·Ø£: ' + error.message, 'error');
        } else {
          showMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'success');
          setTimeout(() => {
            window.location.href = '/'; // ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
          }, 1500);
        }
      });

      // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
      signupForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = e.target.email.value.trim();
        const password = e.target.password.value.trim();

        showMessage('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...', 'info');

        const { data, error } = await supabase.auth.signUp({
          email,
          password,
        });

        if (error) {
          showMessage('Ø®Ø·Ø£: ' + error.message, 'error');
        } else {
          showMessage('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! âœ… ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù‚Ø¨Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.', 'success');
        }
      });

      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Magic Link
      magicForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = e.target.email.value.trim();

        showMessage('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø³Ø­Ø±ÙŠ...', 'info');

        const { data, error } = await supabase.auth.signInWithOtp({
          email,
        });

        if (error) {
          showMessage('Ø®Ø·Ø£: ' + error.message, 'error');
        } else {
          showMessage('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ðŸ“© ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙˆØ§Ø±Ø¯.', 'success');
        }
      });

      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google
      googleBtn.addEventListener('click', async () => {
        const { error } = await supabase.auth.signInWithOAuth({
          provider: 'google',
          options: { redirectTo: window.location.origin },
        });
        if (error) showMessage('Ø®Ø·Ø£: ' + error.message, 'error');
      });

      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± GitHub
      githubBtn.addEventListener('click', async () => {
        const { error } = await supabase.auth.signInWithOAuth({
          provider: 'github',
          options: { redirectTo: window.location.origin },
        });
        if (error) showMessage('Ø®Ø·Ø£: ' + error.message, 'error');
      });
    });
  </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex items-center justify-center font-sans">
  <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl w-full max-w-md p-6 space-y-5">
    <h1 class="text-2xl font-bold text-center text-gray-800 dark:text-gray-100">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h1>
    <div id="msg-box" class="text-center text-sm"></div>

    <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <form id="login-form" class="space-y-3">
      <h2 class="font-semibold text-gray-700 dark:text-gray-200">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <input name="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required class="w-full p-2 border rounded-lg focus:ring" />
      <input name="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required class="w-full p-2 border rounded-lg focus:ring" />
      <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 transition">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </form>

    <hr class="border-gray-300 dark:border-gray-600">

    <!-- Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ -->
    <form id="signup-form" class="space-y-3">
      <h2 class="font-semibold text-gray-700 dark:text-gray-200">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
      <input name="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required class="w-full p-2 border rounded-lg focus:ring" />
      <input name="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required class="w-full p-2 border rounded-lg focus:ring" />
      <button type="submit" class="w-full bg-green-600 text-white p-2 rounded-lg hover:bg-green-700 transition">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
    </form>

    <hr class="border-gray-300 dark:border-gray-600">

    <!-- Magic Link -->
    <form id="magic-form" class="space-y-3">
      <h2 class="font-semibold text-gray-700 dark:text-gray-200">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ø³Ø­Ø±ÙŠ</h2>
      <input name="email" type="email" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required class="w-full p-2 border rounded-lg focus:ring" />
      <button type="submit" class="w-full bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 transition">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·</button>
    </form>

    <div class="flex items-center justify-center space-x-2">
      <span class="text-gray-500 dark:text-gray-400">Ø£Ùˆ</span>
    </div>

    <!-- OAuth Buttons -->
    <div class="flex flex-col gap-3">
      <button id="google-btn" class="flex items-center justify-center gap-2 bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition">
        <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt=""> Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google
      </button>

      <button id="github-btn" class="flex items-center justify-center gap-2 bg-gray-800 text-white p-2 rounded-lg hover:bg-gray-900 transition">
        <img src="https://www.svgrepo.com/show/512317/github-142.svg" class="w-5 h-5" alt=""> Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± GitHub
      </button>
    </div>
  </div>
</body>
</html>
