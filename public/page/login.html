<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تسجيل الدخول - مساحة</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center items-center h-screen">


    <header id="site-header"></header>


  <div class="bg-white p-8 rounded-xl shadow-lg w-96">
    <h2 class="text-center text-2xl font-bold mb-6">مساحة</h2>

    <div class="flex justify-around mb-6">
      <button id="tab-login" class="tab active px-4 py-2 border-b-2 border-black font-semibold">تسجيل الدخول</button>
      <button id="tab-signup" class="tab px-4 py-2 border-b-2 border-transparent">إنشاء حساب</button>
    </div>

    <div id="form-container"></div>
    <p id="message" class="text-center mt-4"></p>
  </div>

  <script type="module">
    import { signUpWithEmail, signInWithEmail, signInWithMagicLink } from '../../admin/assets/js/auth/auth.js';
 
    const tabs = document.querySelectorAll('.tab');
    const formContainer = document.getElementById('form-container');
    const messageEl = document.getElementById('message');

    const urlParams = new URLSearchParams(window.location.search);
    const redirectTo = urlParams.get("redirect") || "../../index.html";

    let currentTab = 'login';

    function renderForm() {
      formContainer.innerHTML = '';
      messageEl.textContent = '';

      if (currentTab === 'login') {
        formContainer.innerHTML = `
          <input type="email" id="email" placeholder="البريد الإلكتروني" class="w-full p-2 mb-3 border rounded"/>
          <input type="password" id="password" placeholder="كلمة المرور" class="w-full p-2 mb-3 border rounded"/>
          <button id="loginBtn" class="w-full bg-black text-white p-2 rounded hover:bg-gray-800">تسجيل الدخول</button>
          <button id="magicLinkBtn" class="w-full bg-yellow-500 text-black p-2 rounded mt-2 hover:bg-yellow-400">تسجيل الدخول عبر الرابط</button>
        `;
        document.getElementById('loginBtn').addEventListener('click', handleLogin);
        document.getElementById('magicLinkBtn').addEventListener('click', handleMagicLink);
      } else {
        formContainer.innerHTML = `
          <input type="email" id="email" placeholder="البريد الإلكتروني" class="w-full p-2 mb-3 border rounded"/>
          <input type="password" id="password" placeholder="كلمة المرور" class="w-full p-2 mb-3 border rounded"/>
          <button id="signupBtn" class="w-full bg-black text-white p-2 rounded hover:bg-gray-800">إنشاء حساب</button>
        `;
        document.getElementById('signupBtn').addEventListener('click', handleSignUp);
      }
    }

    function switchTab(tab) {
      currentTab = tab;
      tabs.forEach(t => t.classList.remove('border-black', 'font-semibold'));
      if(tab==='login'){
        document.getElementById('tab-login').classList.add('border-black','font-semibold');
      } else {
        document.getElementById('tab-signup').classList.add('border-black','font-semibold');
      }
      renderForm();
    }

    document.getElementById('tab-login').addEventListener('click', () => switchTab('login'));
    document.getElementById('tab-signup').addEventListener('click', () => switchTab('signup'));

    async function handleSignUp() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      messageEl.textContent = 'جاري المعالجة...';
      messageEl.className = 'text-center mt-4';

      try {
        const res = await signUpWithEmail(email, password);
        messageEl.textContent = res.message;
        messageEl.classList.add(res.success ? 'text-green-600' : 'text-red-600');
      } catch (err) {
        messageEl.textContent = err.message;
        messageEl.classList.add('text-red-600');
      }
    }

    async function handleLogin() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      messageEl.textContent = 'جاري تسجيل الدخول...';

      try {
        const res = await signInWithEmail(email, password);
        messageEl.textContent = res.message;
        messageEl.className = res.success ? 'text-green-600 mt-4 text-center' : 'text-red-600 mt-4 text-center';
        if(res.success){
          setTimeout(()=> window.location.href = redirectTo, 1000);
        }
      } catch(err) {
        messageEl.textContent = err.message;
        messageEl.className = 'text-red-600 mt-4 text-center';
      }
    }

    async function handleMagicLink() {
      const email = document.getElementById('email').value.trim();
      if (!email) {
        messageEl.textContent = 'يرجى إدخال البريد الإلكتروني';
        messageEl.className = 'text-red-600 mt-4 text-center';
        return;
      }
      messageEl.textContent = 'جاري إرسال الرابط...';

      try {
        const res = await signInWithMagicLink(email);
        messageEl.textContent = res.message;
        messageEl.className = res.success ? 'text-green-600 mt-4 text-center' : 'text-red-600 mt-4 text-center';
      } catch(err) {
        messageEl.textContent = err.message;
        messageEl.className = 'text-red-600 mt-4 text-center';
      }
    }

    renderForm();
  </script>
  <script type="module">
    import { Header } from './public/assets/js/header.js';
    document.addEventListener('DOMContentLoaded', () => { Header.init(); });
  </script>

</body>
</html>


